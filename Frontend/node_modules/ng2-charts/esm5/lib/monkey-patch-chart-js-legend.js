/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// tslint:disable:variable-name
/** @type {?} */
var helpers = Chart.helpers;
/** @type {?} */
var defaults = Chart.defaults;
/** @type {?} */
var valueOrDefault = helpers.valueOrDefault;
/**
 * @param {?} labelOpts
 * @param {?} fontSize
 * @return {?}
 */
function getBoxWidth(labelOpts, fontSize) {
    return labelOpts.usePointStyle && labelOpts.boxWidth > fontSize ?
        fontSize :
        labelOpts.boxWidth;
}
/**
 * @return {?}
 */
function fit() {
    /** @type {?} */
    var me = this;
    /** @type {?} */
    var opts = me.options;
    /** @type {?} */
    var labelOpts = opts.labels;
    /** @type {?} */
    var display = opts.display;
    /** @type {?} */
    var ctx = me.ctx;
    /** @type {?} */
    var labelFont = helpers.options._parseFont(labelOpts);
    /** @type {?} */
    var fontSize = labelFont.size;
    // Reset hit boxes
    /** @type {?} */
    var hitboxes = me.legendHitBoxes = [];
    /** @type {?} */
    var minSize = me.minSize;
    /** @type {?} */
    var isHorizontal = me.isHorizontal();
    if (isHorizontal) {
        minSize.width = me.maxWidth; // fill all the width
        minSize.height = display ? 10 : 0;
    }
    else {
        minSize.width = display ? 10 : 0;
        minSize.height = me.maxHeight; // fill all the height
    }
    /** @type {?} */
    var getMaxLineWidth = (/**
     * @param {?} textLines
     * @return {?}
     */
    function (textLines) {
        return textLines.map((/**
         * @param {?} textLine
         * @return {?}
         */
        function (textLine) {
            return ctx.measureText(textLine).width;
        })).reduce((/**
         * @param {?} acc
         * @param {?} v
         * @return {?}
         */
        function (acc, v) {
            return v > acc ? v : acc;
        }), 0);
    });
    // Increase sizes here
    if (display) {
        ctx.font = labelFont.string;
        if (isHorizontal) {
            // Labels
            // Width of each line of legend boxes. Labels wrap onto multiple lines when there are too many to fit on one
            /** @type {?} */
            var lineWidths_1 = me.lineWidths = [0];
            /** @type {?} */
            var maxHeight_1 = 0;
            /** @type {?} */
            var totalHeight_1 = 0;
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';
            helpers.each(me.legendItems, (/**
             * @param {?} legendItem
             * @param {?} i
             * @return {?}
             */
            function (legendItem, i) {
                /** @type {?} */
                var width;
                /** @type {?} */
                var height;
                /** @type {?} */
                var grossHeight;
                if (helpers.isArray(legendItem.text)) {
                    width = getMaxLineWidth(legendItem.text);
                    height = fontSize * legendItem.text.length;
                    grossHeight = height;
                }
                else {
                    width = ctx.measureText(legendItem.text).width;
                    height = fontSize;
                    grossHeight = height + labelOpts.padding;
                }
                width += getBoxWidth(labelOpts, fontSize) + (fontSize / 2);
                if (grossHeight > maxHeight_1) {
                    maxHeight_1 = grossHeight;
                }
                if (lineWidths_1[lineWidths_1.length - 1] + width + 2 * labelOpts.padding > minSize.width) {
                    totalHeight_1 += maxHeight_1;
                    maxHeight_1 = 0;
                    lineWidths_1[lineWidths_1.length - (i > 0 ? 0 : 1)] = 0;
                }
                // Store the hitbox width and height here. Final position will be updated in `draw`
                hitboxes[i] = {
                    left: 0,
                    top: 0,
                    width: width,
                    height: height,
                };
                lineWidths_1[lineWidths_1.length - 1] += width + labelOpts.padding;
            }));
            minSize.height += totalHeight_1 + maxHeight_1;
        }
        else {
            /** @type {?} */
            var vPadding_1 = labelOpts.padding;
            /** @type {?} */
            var columnWidths_1 = me.columnWidths = [];
            /** @type {?} */
            var columnHeights_1 = me.columnHeights = [];
            /** @type {?} */
            var totalWidth_1 = labelOpts.padding;
            /** @type {?} */
            var currentColWidth_1 = 0;
            /** @type {?} */
            var currentColHeight_1 = 0;
            helpers.each(me.legendItems, (/**
             * @param {?} legendItem
             * @param {?} i
             * @return {?}
             */
            function (legendItem, i) {
                /** @type {?} */
                var itemWidth;
                /** @type {?} */
                var height;
                if (helpers.isArray(legendItem.text)) {
                    itemWidth = getMaxLineWidth(legendItem.text);
                    height = fontSize * legendItem.text.length;
                }
                else {
                    itemWidth = ctx.measureText(legendItem.text).width;
                    height = fontSize;
                }
                itemWidth += getBoxWidth(labelOpts, fontSize) + (fontSize / 2);
                // If too tall, go to new column
                if (i > 0 && currentColHeight_1 + fontSize + 2 * vPadding_1 > minSize.height) {
                    totalWidth_1 += currentColWidth_1 + labelOpts.padding;
                    columnWidths_1.push(currentColWidth_1); // previous column width
                    columnHeights_1.push(currentColHeight_1);
                    currentColWidth_1 = 0;
                    currentColHeight_1 = 0;
                }
                // Get max width
                currentColWidth_1 = Math.max(currentColWidth_1, itemWidth);
                currentColHeight_1 += fontSize + vPadding_1;
                // Store the hitbox width and height here. Final position will be updated in `draw`
                hitboxes[i] = {
                    left: 0,
                    top: 0,
                    width: itemWidth,
                    height: height
                };
            }));
            totalWidth_1 += currentColWidth_1;
            columnWidths_1.push(currentColWidth_1);
            columnHeights_1.push(currentColHeight_1);
            minSize.width += totalWidth_1;
        }
    }
    me.width = minSize.width;
    me.height = minSize.height;
}
/**
 * @param {?} vm
 * @param {?} align
 * @return {?}
 */
function getAlignedX(vm, align) {
    return align === 'center'
        ? vm.x + vm.width / 2
        : align === 'right'
            ? vm.x + vm.width - vm.xPadding
            : vm.x + vm.xPadding;
}
/**
 * @return {?}
 */
function draw() {
    /** @type {?} */
    var me = this;
    /** @type {?} */
    var opts = me.options;
    /** @type {?} */
    var labelOpts = opts.labels;
    /** @type {?} */
    var globalDefaults = defaults.global;
    /** @type {?} */
    var defaultColor = globalDefaults.defaultColor;
    /** @type {?} */
    var lineDefault = globalDefaults.elements.line;
    /** @type {?} */
    var legendHeight = me.height;
    /** @type {?} */
    var columnHeights = me.columnHeights;
    /** @type {?} */
    var legendWidth = me.width;
    /** @type {?} */
    var lineWidths = me.lineWidths;
    if (opts.display) {
        /** @type {?} */
        var ctx_1 = me.ctx;
        /** @type {?} */
        var fontColor = valueOrDefault(labelOpts.fontColor, globalDefaults.defaultFontColor);
        /** @type {?} */
        var labelFont = helpers.options._parseFont(labelOpts);
        /** @type {?} */
        var fontSize_1 = labelFont.size;
        /** @type {?} */
        var cursor_1;
        // Canvas setup
        ctx_1.textAlign = 'left';
        ctx_1.textBaseline = 'middle';
        ctx_1.lineWidth = 0.5;
        ctx_1.strokeStyle = fontColor; // for strikethrough effect
        ctx_1.fillStyle = fontColor; // render in correct colour
        ctx_1.font = labelFont.string;
        /** @type {?} */
        var boxWidth_1 = getBoxWidth(labelOpts, fontSize_1);
        /** @type {?} */
        var hitboxes_1 = me.legendHitBoxes;
        /** @type {?} */
        var maxHeight_2 = hitboxes_1.map((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            return x.height;
        })).reduce((/**
         * @param {?} acc
         * @param {?} v
         * @return {?}
         */
        function (acc, v) {
            return v > acc ? v : acc;
        }), 0);
        // current position
        /** @type {?} */
        var drawLegendBox_1 = (/**
         * @param {?} x
         * @param {?} y
         * @param {?} legendItem
         * @return {?}
         */
        function (x, y, legendItem) {
            if (isNaN(boxWidth_1) || boxWidth_1 <= 0) {
                return;
            }
            // Set the ctx for the box
            ctx_1.save();
            /** @type {?} */
            var lineWidth = valueOrDefault(legendItem.lineWidth, lineDefault.borderWidth);
            ctx_1.fillStyle = valueOrDefault(legendItem.fillStyle, defaultColor);
            ctx_1.lineCap = valueOrDefault(legendItem.lineCap, lineDefault.borderCapStyle);
            ctx_1.lineDashOffset = valueOrDefault(legendItem.lineDashOffset, lineDefault.borderDashOffset);
            ctx_1.lineJoin = valueOrDefault(legendItem.lineJoin, lineDefault.borderJoinStyle);
            ctx_1.lineWidth = lineWidth;
            ctx_1.strokeStyle = valueOrDefault(legendItem.strokeStyle, defaultColor);
            if (ctx_1.setLineDash) {
                // IE 9 and 10 do not support line dash
                ctx_1.setLineDash(valueOrDefault(legendItem.lineDash, lineDefault.borderDash));
            }
            if (opts.labels && opts.labels.usePointStyle) {
                // Recalculate x and y for drawPoint() because its expecting
                // x and y to be center of figure (instead of top left)
                /** @type {?} */
                var radius = boxWidth_1 * Math.SQRT2 / 2;
                /** @type {?} */
                var centerX = x + boxWidth_1 / 2;
                /** @type {?} */
                var centerY = y + fontSize_1 / 2;
                // Draw pointStyle as legend symbol
                helpers.canvas.drawPoint(ctx_1, legendItem.pointStyle, radius, centerX, centerY);
            }
            else {
                // Draw box as legend symbol
                if (lineWidth !== 0) {
                    ctx_1.strokeRect(x, y, boxWidth_1, fontSize_1);
                }
                ctx_1.fillRect(x, y, boxWidth_1, fontSize_1);
            }
            ctx_1.restore();
        });
        /** @type {?} */
        var drawStrikeThrough_1 = (/**
         * @param {?} x
         * @param {?} y
         * @param {?} w
         * @return {?}
         */
        function (x, y, w) {
            ctx_1.beginPath();
            ctx_1.lineWidth = 2;
            ctx_1.moveTo(x, y);
            ctx_1.lineTo(x + w, y);
            ctx_1.stroke();
        });
        /** @type {?} */
        var drawCrossOver_1 = (/**
         * @param {?} x
         * @param {?} y
         * @param {?} w
         * @param {?} h
         * @return {?}
         */
        function (x, y, w, h) {
            ctx_1.beginPath();
            ctx_1.lineWidth = 2;
            ctx_1.moveTo(x, y);
            ctx_1.lineTo(x + w, y + h);
            ctx_1.moveTo(x, y + h);
            ctx_1.lineTo(x + w, y);
            ctx_1.stroke();
        });
        /** @type {?} */
        var fillText_1 = (/**
         * @param {?} x
         * @param {?} y
         * @param {?} legendItem
         * @param {?} textWidth
         * @return {?}
         */
        function (x, y, legendItem, textWidth) {
            /** @type {?} */
            var halfFontSize = fontSize_1 / 2;
            /** @type {?} */
            var xLeft = boxWidth_1 + halfFontSize + x;
            /** @type {?} */
            var yMiddle = y + halfFontSize;
            if (helpers.isArray(legendItem.text)) {
                helpers.each(legendItem.text, (/**
                 * @param {?} textLine
                 * @param {?} index
                 * @return {?}
                 */
                function (textLine, index) {
                    /** @type {?} */
                    var lineOffset = index * fontSize_1;
                    ctx_1.fillText(textLine, xLeft, yMiddle + lineOffset);
                }));
            }
            else {
                ctx_1.fillText(legendItem.text, xLeft, yMiddle);
            }
            if (legendItem.hidden) {
                if (helpers.isArray(legendItem.text)) {
                    drawCrossOver_1(xLeft, yMiddle, textWidth, (legendItem.text.length - 1) * (fontSize_1 - 1));
                }
                else {
                    drawStrikeThrough_1(xLeft, yMiddle, textWidth);
                }
            }
        });
        /** @type {?} */
        var alignmentOffset_1 = (/**
         * @param {?} dimension
         * @param {?} blockSize
         * @return {?}
         */
        function (dimension, blockSize) {
            switch (opts.align) {
                case 'start':
                    return labelOpts.padding;
                case 'end':
                    return dimension - blockSize;
                default: // center
                    return (dimension - blockSize + labelOpts.padding) / 2;
            }
        });
        // Horizontal
        /** @type {?} */
        var isHorizontal_1 = me.isHorizontal();
        if (isHorizontal_1) {
            cursor_1 = {
                x: me.left + alignmentOffset_1(legendWidth, lineWidths[0]),
                y: me.top + labelOpts.padding,
                line: 0
            };
        }
        else {
            cursor_1 = {
                x: me.left + labelOpts.padding,
                y: me.top + alignmentOffset_1(legendHeight, columnHeights[0]),
                line: 0
            };
        }
        /** @type {?} */
        var itemHeight_1 = maxHeight_2;
        helpers.each(me.legendItems, (/**
         * @param {?} legendItem
         * @param {?} i
         * @return {?}
         */
        function (legendItem, i) {
            /** @type {?} */
            var textWidth;
            /** @type {?} */
            var boxTopOffset;
            if (helpers.isArray(legendItem.text)) {
                textWidth = legendItem.text.map((/**
                 * @param {?} textLine
                 * @return {?}
                 */
                function (textLine) {
                    return ctx_1.measureText(textLine).width;
                })).reduce((/**
                 * @param {?} acc
                 * @param {?} v
                 * @return {?}
                 */
                function (acc, v) {
                    return v > acc ? v : acc;
                }), 0);
                boxTopOffset = fontSize_1 / 2 * (legendItem.text.length - 1);
            }
            else {
                textWidth = ctx_1.measureText(legendItem.text).width;
                boxTopOffset = 0;
            }
            /** @type {?} */
            var width = boxWidth_1 + (fontSize_1 / 2) + textWidth;
            /** @type {?} */
            var x = cursor_1.x;
            /** @type {?} */
            var topOffset = Math.trunc((maxHeight_2 - hitboxes_1[i].height) / 2);
            /** @type {?} */
            var y = cursor_1.y + topOffset;
            // Use (me.left + me.minSize.width) and (me.top + me.minSize.height)
            // instead of me.right and me.bottom because me.width and me.height
            // may have been changed since me.minSize was calculated
            if (isHorizontal_1) {
                if (i > 0 && x + width + labelOpts.padding > me.left + me.minSize.width) {
                    y = cursor_1.y += itemHeight_1;
                    cursor_1.line++;
                    x = cursor_1.x = me.left + alignmentOffset_1(legendWidth, lineWidths[cursor_1.line]);
                }
            }
            else if (i > 0 && y + itemHeight_1 > me.top + me.minSize.height) {
                x = cursor_1.x = x + me.columnWidths[cursor_1.line] + labelOpts.padding;
                cursor_1.line++;
                y = cursor_1.y = me.top + alignmentOffset_1(legendHeight, columnHeights[cursor_1.line]);
            }
            drawLegendBox_1(x, y + boxTopOffset, legendItem);
            hitboxes_1[i].left = x;
            hitboxes_1[i].top = y;
            // Fill the actual label
            fillText_1(x, y, legendItem, textWidth);
            if (isHorizontal_1) {
                cursor_1.x += width + labelOpts.padding;
            }
            else {
                cursor_1.y += itemHeight_1;
            }
        }));
    }
}
/**
 * @return {?}
 */
export function monkeyPatchChartJsLegend() {
    /** @type {?} */
    var plugins = Chart.plugins.getAll();
    /** @type {?} */
    var legend = plugins.filter((/**
     * @param {?} p
     * @return {?}
     */
    function (p) { return p.id === 'legend'; }))[0];
    legend._element.prototype.fit = fit;
    legend._element.prototype.draw = draw;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9ua2V5LXBhdGNoLWNoYXJ0LWpzLWxlZ2VuZC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nMi1jaGFydHMvIiwic291cmNlcyI6WyJsaWIvbW9ua2V5LXBhdGNoLWNoYXJ0LWpzLWxlZ2VuZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7SUFVTSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU87O0lBQ3ZCLFFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUTs7SUFDekIsY0FBYyxHQUFHLE9BQU8sQ0FBQyxjQUFjOzs7Ozs7QUFFN0MsU0FBUyxXQUFXLENBQUMsU0FBUyxFQUFFLFFBQVE7SUFDdEMsT0FBTyxTQUFTLENBQUMsYUFBYSxJQUFJLFNBQVMsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLENBQUM7UUFDL0QsUUFBUSxDQUFDLENBQUM7UUFDVixTQUFTLENBQUMsUUFBUSxDQUFDO0FBQ3ZCLENBQUM7Ozs7QUFFRCxTQUFTLEdBQUc7O1FBQ0osRUFBRSxHQUFHLElBQUk7O1FBQ1QsSUFBSSxHQUFHLEVBQUUsQ0FBQyxPQUFPOztRQUNqQixTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU07O1FBQ3ZCLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTzs7UUFFdEIsR0FBRyxHQUFHLEVBQUUsQ0FBQyxHQUFHOztRQUVaLFNBQVMsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUM7O1FBQ2pELFFBQVEsR0FBRyxTQUFTLENBQUMsSUFBSTs7O1FBR3pCLFFBQVEsR0FBRyxFQUFFLENBQUMsY0FBYyxHQUFHLEVBQUU7O1FBRWpDLE9BQU8sR0FBRyxFQUFFLENBQUMsT0FBTzs7UUFDcEIsWUFBWSxHQUFHLEVBQUUsQ0FBQyxZQUFZLEVBQUU7SUFFdEMsSUFBSSxZQUFZLEVBQUU7UUFDaEIsT0FBTyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMscUJBQXFCO1FBQ2xELE9BQU8sQ0FBQyxNQUFNLEdBQUcsT0FBTyxD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RyxHQUFHLENBQUM7SUFDcEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztBQUN4QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHNsaW50OmRpc2FibGU6dmFyaWFibGUtbmFtZVxyXG5cclxuZGVjbGFyZSBjbGFzcyBDaGFydCB7XHJcbiAgc3RhdGljIHJlYWRvbmx5IENoYXJ0OiB0eXBlb2YgQ2hhcnQ7XHJcbiAgc3RhdGljIHJlYWRvbmx5IFRvb2x0aXA6IGFueTtcclxuICBzdGF0aWMgcmVhZG9ubHkgaGVscGVyczogYW55O1xyXG4gIHN0YXRpYyByZWFkb25seSBkZWZhdWx0czogYW55O1xyXG4gIHN0YXRpYyByZWFkb25seSBwbHVnaW5zOiBhbnk7XHJcbn1cclxuXHJcbmNvbnN0IGhlbHBlcnMgPSBDaGFydC5oZWxwZXJzO1xyXG5jb25zdCBkZWZhdWx0cyA9IENoYXJ0LmRlZmF1bHRzO1xyXG5jb25zdCB2YWx1ZU9yRGVmYXVsdCA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQ7XHJcblxyXG5mdW5jdGlvbiBnZXRCb3hXaWR0aChsYWJlbE9wdHMsIGZvbnRTaXplKSB7XHJcbiAgcmV0dXJuIGxhYmVsT3B0cy51c2VQb2ludFN0eWxlICYmIGxhYmVsT3B0cy5ib3hXaWR0aCA+IGZvbnRTaXplID9cclxuICAgIGZvbnRTaXplIDpcclxuICAgIGxhYmVsT3B0cy5ib3hXaWR0aDtcclxufVxyXG5cclxuZnVuY3Rpb24gZml0KCkge1xyXG4gIGNvbnN0IG1lID0gdGhpcztcclxuICBjb25zdCBvcHRzID0gbWUub3B0aW9ucztcclxuICBjb25zdCBsYWJlbE9wdHMgPSBvcHRzLmxhYmVscztcclxuICBjb25zdCBkaXNwbGF5ID0gb3B0cy5kaXNwbGF5O1xyXG5cclxuICBjb25zdCBjdHggPSBtZS5jdHg7XHJcblxyXG4gIGNvbnN0IGxhYmVsRm9udCA9IGhlbHBlcnMub3B0aW9ucy5fcGFyc2VGb250KGxhYmVsT3B0cyk7XHJcbiAgY29uc3QgZm9udFNpemUgPSBsYWJlbEZvbnQuc2l6ZTtcclxuXHJcbiAgLy8gUmVzZXQgaGl0IGJveGVzXHJcbiAgY29uc3QgaGl0Ym94ZXMgPSBtZS5sZWdlbmRIaXRCb3hlcyA9IFtdO1xyXG5cclxuICBjb25zdCBtaW5TaXplID0gbWUubWluU2l6ZTtcclxuICBjb25zdCBpc0hvcml6b250YWwgPSBtZS5pc0hvcml6b250YWwoKTtcclxuXHJcbiAgaWYgKGlzSG9yaXpvbnRhbCkge1xyXG4gICAgbWluU2l6ZS53aWR0aCA9IG1lLm1heFdpZHRoOyAvLyBmaWxsIGFsbCB0aGUgd2lkdGhcclxuICAgIG1pblNpemUuaGVpZ2h0ID0gZGlzcGxheSA/IDEwIDogMDtcclxuICB9IGVsc2Uge1xyXG4gICAgbWluU2l6ZS53aWR0aCA9IGRpc3BsYXkgPyAxMCA6IDA7XHJcbiAgICBtaW5TaXplLmhlaWdodCA9IG1lLm1heEhlaWdodDsgLy8gZmlsbCBhbGwgdGhlIGhlaWdodFxyXG4gIH1cclxuXHJcbiAgY29uc3QgZ2V0TWF4TGluZVdpZHRoID0gdGV4dExpbmVzID0+IHtcclxuICAgIHJldHVybiB0ZXh0TGluZXMubWFwKHRleHRMaW5lID0+IHtcclxuICAgICAgcmV0dXJuIGN0eC5tZWFzdXJlVGV4dCh0ZXh0TGluZSkud2lkdGg7XHJcbiAgICB9KS5yZWR1Y2UoKGFjYywgdikgPT4ge1xyXG4gICAgICByZXR1cm4gdiA+IGFjYyA/IHYgOiBhY2M7XHJcbiAgICB9LCAwKTtcclxuICB9O1xyXG5cclxuICAvLyBJbmNyZWFzZSBzaXplcyBoZXJlXHJcbiAgaWYgKGRpc3BsYXkpIHtcclxuICAgIGN0eC5mb250ID0gbGFiZWxGb250LnN0cmluZztcclxuXHJcbiAgICBpZiAoaXNIb3Jpem9udGFsKSB7XHJcblxyXG4gICAgICAvLyBMYWJlbHNcclxuXHJcbiAgICAgIC8vIFdpZHRoIG9mIGVhY2ggbGluZSBvZiBsZWdlbmQgYm94ZXMuIExhYmVscyB3cmFwIG9udG8gbXVsdGlwbGUgbGluZXMgd2hlbiB0aGVyZSBhcmUgdG9vIG1hbnkgdG8gZml0IG9uIG9uZVxyXG4gICAgICBjb25zdCBsaW5lV2lkdGhzID0gbWUubGluZVdpZHRocyA9IFswXTtcclxuICAgICAgbGV0IG1heEhlaWdodCA9IDA7XHJcbiAgICAgIGxldCB0b3RhbEhlaWdodCA9IDA7XHJcblxyXG4gICAgICBjdHgudGV4dEFsaWduID0gJ2xlZnQnO1xyXG4gICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ3RvcCc7XHJcblxyXG4gICAgICBoZWxwZXJzLmVhY2gobWUubGVnZW5kSXRlbXMsIChsZWdlbmRJdGVtLCBpKSA9PiB7XHJcbiAgICAgICAgbGV0IHdpZHRoO1xyXG4gICAgICAgIGxldCBoZWlnaHQ7XHJcbiAgICAgICAgbGV0IGdyb3NzSGVpZ2h0O1xyXG5cclxuICAgICAgICBpZiAoaGVscGVycy5pc0FycmF5KGxlZ2VuZEl0ZW0udGV4dCkpIHtcclxuICAgICAgICAgIHdpZHRoID0gZ2V0TWF4TGluZVdpZHRoKGxlZ2VuZEl0ZW0udGV4dCk7XHJcbiAgICAgICAgICBoZWlnaHQgPSBmb250U2l6ZSAqIGxlZ2VuZEl0ZW0udGV4dC5sZW5ndGg7XHJcbiAgICAgICAgICBncm9zc0hlaWdodCA9IGhlaWdodDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgd2lkdGggPSBjdHgubWVhc3VyZVRleHQobGVnZW5kSXRlbS50ZXh0KS53aWR0aDtcclxuICAgICAgICAgIGhlaWdodCA9IGZvbnRTaXplO1xyXG4gICAgICAgICAgZ3Jvc3NIZWlnaHQgPSBoZWlnaHQgKyBsYWJlbE9wdHMucGFkZGluZztcclxuICAgICAgICB9XHJcbiAgICAgICAgd2lkdGggKz0gZ2V0Qm94V2lkdGgobGFiZWxPcHRzLCBmb250U2l6ZSkgKyAoZm9udFNpemUgLyAyKTtcclxuXHJcbiAgICAgICAgaWYgKGdyb3NzSGVpZ2h0ID4gbWF4SGVpZ2h0KSB7XHJcbiAgICAgICAgICBtYXhIZWlnaHQgPSBncm9zc0hlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChsaW5lV2lkdGhzW2xpbmVXaWR0aHMubGVuZ3RoIC0gMV0gKyB3aWR0aCArIDIgKiBsYWJlbE9wdHMucGFkZGluZyA+IG1pblNpemUud2lkdGgpIHtcclxuICAgICAgICAgIHRvdGFsSGVpZ2h0ICs9IG1heEhlaWdodDtcclxuICAgICAgICAgIG1heEhlaWdodCA9IDA7XHJcbiAgICAgICAgICBsaW5lV2lkdGhzW2xpbmVXaWR0aHMubGVuZ3RoIC0gKGkgPiAwID8gMCA6IDEpXSA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTdG9yZSB0aGUgaGl0Ym94IHdpZHRoIGFuZCBoZWlnaHQgaGVyZS4gRmluYWwgcG9zaXRpb24gd2lsbCBiZSB1cGRhdGVkIGluIGBkcmF3YFxyXG4gICAgICAgIGhpdGJveGVzW2ldID0ge1xyXG4gICAgICAgICAgbGVmdDogMCxcclxuICAgICAgICAgIHRvcDogMCxcclxuICAgICAgICAgIHdpZHRoLFxyXG4gICAgICAgICAgaGVpZ2h0LFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGxpbmVXaWR0aHNbbGluZVdpZHRocy5sZW5ndGggLSAxXSArPSB3aWR0aCArIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG1pblNpemUuaGVpZ2h0ICs9IHRvdGFsSGVpZ2h0ICsgbWF4SGVpZ2h0O1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHZQYWRkaW5nID0gbGFiZWxPcHRzLnBhZGRpbmc7XHJcbiAgICAgIGNvbnN0IGNvbHVtbldpZHRocyA9IG1lLmNvbHVtbldpZHRocyA9IFtdO1xyXG4gICAgICBjb25zdCBjb2x1bW5IZWlnaHRzID0gbWUuY29sdW1uSGVpZ2h0cyA9IFtdO1xyXG4gICAgICBsZXQgdG90YWxXaWR0aCA9IGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICBsZXQgY3VycmVudENvbFdpZHRoID0gMDtcclxuICAgICAgbGV0IGN1cnJlbnRDb2xIZWlnaHQgPSAwO1xyXG5cclxuICAgICAgaGVscGVycy5lYWNoKG1lLmxlZ2VuZEl0ZW1zLCAobGVnZW5kSXRlbSwgaSkgPT4ge1xyXG4gICAgICAgIGxldCBpdGVtV2lkdGg7XHJcbiAgICAgICAgbGV0IGhlaWdodDtcclxuXHJcbiAgICAgICAgaWYgKGhlbHBlcnMuaXNBcnJheShsZWdlbmRJdGVtLnRleHQpKSB7XHJcbiAgICAgICAgICBpdGVtV2lkdGggPSBnZXRNYXhMaW5lV2lkdGgobGVnZW5kSXRlbS50ZXh0KTtcclxuICAgICAgICAgIGhlaWdodCA9IGZvbnRTaXplICogbGVnZW5kSXRlbS50ZXh0Lmxlbmd0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaXRlbVdpZHRoID0gY3R4Lm1lYXN1cmVUZXh0KGxlZ2VuZEl0ZW0udGV4dCkud2lkdGg7XHJcbiAgICAgICAgICBoZWlnaHQgPSBmb250U2l6ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaXRlbVdpZHRoICs9IGdldEJveFdpZHRoKGxhYmVsT3B0cywgZm9udFNpemUpICsgKGZvbnRTaXplIC8gMik7XHJcblxyXG4gICAgICAgIC8vIElmIHRvbyB0YWxsLCBnbyB0byBuZXcgY29sdW1uXHJcbiAgICAgICAgaWYgKGkgPiAwICYmIGN1cnJlbnRDb2xIZWlnaHQgKyBmb250U2l6ZSArIDIgKiB2UGFkZGluZyA+IG1pblNpemUuaGVpZ2h0KSB7XHJcbiAgICAgICAgICB0b3RhbFdpZHRoICs9IGN1cnJlbnRDb2xXaWR0aCArIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICAgICAgY29sdW1uV2lkdGhzLnB1c2goY3VycmVudENvbFdpZHRoKTsgLy8gcHJldmlvdXMgY29sdW1uIHdpZHRoXHJcbiAgICAgICAgICBjb2x1bW5IZWlnaHRzLnB1c2goY3VycmVudENvbEhlaWdodCk7XHJcbiAgICAgICAgICBjdXJyZW50Q29sV2lkdGggPSAwO1xyXG4gICAgICAgICAgY3VycmVudENvbEhlaWdodCA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZXQgbWF4IHdpZHRoXHJcbiAgICAgICAgY3VycmVudENvbFdpZHRoID0gTWF0aC5tYXgoY3VycmVudENvbFdpZHRoLCBpdGVtV2lkdGgpO1xyXG4gICAgICAgIGN1cnJlbnRDb2xIZWlnaHQgKz0gZm9udFNpemUgKyB2UGFkZGluZztcclxuXHJcbiAgICAgICAgLy8gU3RvcmUgdGhlIGhpdGJveCB3aWR0aCBhbmQgaGVpZ2h0IGhlcmUuIEZpbmFsIHBvc2l0aW9uIHdpbGwgYmUgdXBkYXRlZCBpbiBgZHJhd2BcclxuICAgICAgICBoaXRib3hlc1tpXSA9IHtcclxuICAgICAgICAgIGxlZnQ6IDAsXHJcbiAgICAgICAgICB0b3A6IDAsXHJcbiAgICAgICAgICB3aWR0aDogaXRlbVdpZHRoLFxyXG4gICAgICAgICAgaGVpZ2h0XHJcbiAgICAgICAgfTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0b3RhbFdpZHRoICs9IGN1cnJlbnRDb2xXaWR0aDtcclxuICAgICAgY29sdW1uV2lkdGhzLnB1c2goY3VycmVudENvbFdpZHRoKTtcclxuICAgICAgY29sdW1uSGVpZ2h0cy5wdXNoKGN1cnJlbnRDb2xIZWlnaHQpO1xyXG4gICAgICBtaW5TaXplLndpZHRoICs9IHRvdGFsV2lkdGg7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtZS53aWR0aCA9IG1pblNpemUud2lkdGg7XHJcbiAgbWUuaGVpZ2h0ID0gbWluU2l6ZS5oZWlnaHQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEFsaWduZWRYKHZtLCBhbGlnbikge1xyXG4gIHJldHVybiBhbGlnbiA9PT0gJ2NlbnRlcidcclxuICAgID8gdm0ueCArIHZtLndpZHRoIC8gMlxyXG4gICAgOiBhbGlnbiA9PT0gJ3JpZ2h0J1xyXG4gICAgICA/IHZtLnggKyB2bS53aWR0aCAtIHZtLnhQYWRkaW5nXHJcbiAgICAgIDogdm0ueCArIHZtLnhQYWRkaW5nO1xyXG59XHJcblxyXG5mdW5jdGlvbiBkcmF3KCkge1xyXG4gIGNvbnN0IG1lID0gdGhpcztcclxuICBjb25zdCBvcHRzID0gbWUub3B0aW9ucztcclxuICBjb25zdCBsYWJlbE9wdHMgPSBvcHRzLmxhYmVscztcclxuICBjb25zdCBnbG9iYWxEZWZhdWx0cyA9IGRlZmF1bHRzLmdsb2JhbDtcclxuICBjb25zdCBkZWZhdWx0Q29sb3IgPSBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Q29sb3I7XHJcbiAgY29uc3QgbGluZURlZmF1bHQgPSBnbG9iYWxEZWZhdWx0cy5lbGVtZW50cy5saW5lO1xyXG4gIGNvbnN0IGxlZ2VuZEhlaWdodCA9IG1lLmhlaWdodDtcclxuICBjb25zdCBjb2x1bW5IZWlnaHRzID0gbWUuY29sdW1uSGVpZ2h0cztcclxuICBjb25zdCBsZWdlbmRXaWR0aCA9IG1lLndpZHRoO1xyXG4gIGNvbnN0IGxpbmVXaWR0aHMgPSBtZS5saW5lV2lkdGhzO1xyXG5cclxuICBpZiAob3B0cy5kaXNwbGF5KSB7XHJcbiAgICBjb25zdCBjdHggPSBtZS5jdHg7XHJcbiAgICBjb25zdCBmb250Q29sb3IgPSB2YWx1ZU9yRGVmYXVsdChsYWJlbE9wdHMuZm9udENvbG9yLCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udENvbG9yKTtcclxuICAgIGNvbnN0IGxhYmVsRm9udCA9IGhlbHBlcnMub3B0aW9ucy5fcGFyc2VGb250KGxhYmVsT3B0cyk7XHJcbiAgICBjb25zdCBmb250U2l6ZSA9IGxhYmVsRm9udC5zaXplO1xyXG4gICAgbGV0IGN1cnNvcjtcclxuXHJcbiAgICAvLyBDYW52YXMgc2V0dXBcclxuICAgIGN0eC50ZXh0QWxpZ24gPSAnbGVmdCc7XHJcbiAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7XHJcbiAgICBjdHgubGluZVdpZHRoID0gMC41O1xyXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gZm9udENvbG9yOyAvLyBmb3Igc3RyaWtldGhyb3VnaCBlZmZlY3RcclxuICAgIGN0eC5maWxsU3R5bGUgPSBmb250Q29sb3I7IC8vIHJlbmRlciBpbiBjb3JyZWN0IGNvbG91clxyXG4gICAgY3R4LmZvbnQgPSBsYWJlbEZvbnQuc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0IGJveFdpZHRoID0gZ2V0Qm94V2lkdGgobGFiZWxPcHRzLCBmb250U2l6ZSk7XHJcbiAgICBjb25zdCBoaXRib3hlcyA9IG1lLmxlZ2VuZEhpdEJveGVzO1xyXG5cclxuICAgIGNvbnN0IG1heEhlaWdodCA9IGhpdGJveGVzLm1hcCh4ID0+IHtcclxuICAgICAgcmV0dXJuIHguaGVpZ2h0O1xyXG4gICAgfSkucmVkdWNlKChhY2MsIHYpID0+IHtcclxuICAgICAgcmV0dXJuIHYgPiBhY2MgPyB2IDogYWNjO1xyXG4gICAgfSwgMCk7XHJcblxyXG4gICAgLy8gY3VycmVudCBwb3NpdGlvblxyXG4gICAgY29uc3QgZHJhd0xlZ2VuZEJveCA9ICh4LCB5LCBsZWdlbmRJdGVtKSA9PiB7XHJcbiAgICAgIGlmIChpc05hTihib3hXaWR0aCkgfHwgYm94V2lkdGggPD0gMCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU2V0IHRoZSBjdHggZm9yIHRoZSBib3hcclxuICAgICAgY3R4LnNhdmUoKTtcclxuXHJcbiAgICAgIGNvbnN0IGxpbmVXaWR0aCA9IHZhbHVlT3JEZWZhdWx0KGxlZ2VuZEl0ZW0ubGluZVdpZHRoLCBsaW5lRGVmYXVsdC5ib3JkZXJXaWR0aCk7XHJcbiAgICAgIGN0eC5maWxsU3R5bGUgPSB2YWx1ZU9yRGVmYXVsdChsZWdlbmRJdGVtLmZpbGxTdHlsZSwgZGVmYXVsdENvbG9yKTtcclxuICAgICAgY3R4LmxpbmVDYXAgPSB2YWx1ZU9yRGVmYXVsdChsZWdlbmRJdGVtLmxpbmVDYXAsIGxpbmVEZWZhdWx0LmJvcmRlckNhcFN0eWxlKTtcclxuICAgICAgY3R4LmxpbmVEYXNoT2Zmc2V0ID0gdmFsdWVPckRlZmF1bHQobGVnZW5kSXRlbS5saW5lRGFzaE9mZnNldCwgbGluZURlZmF1bHQuYm9yZGVyRGFzaE9mZnNldCk7XHJcbiAgICAgIGN0eC5saW5lSm9pbiA9IHZhbHVlT3JEZWZhdWx0KGxlZ2VuZEl0ZW0ubGluZUpvaW4sIGxpbmVEZWZhdWx0LmJvcmRlckpvaW5TdHlsZSk7XHJcbiAgICAgIGN0eC5saW5lV2lkdGggPSBsaW5lV2lkdGg7XHJcbiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHZhbHVlT3JEZWZhdWx0KGxlZ2VuZEl0ZW0uc3Ryb2tlU3R5bGUsIGRlZmF1bHRDb2xvcik7XHJcblxyXG4gICAgICBpZiAoY3R4LnNldExpbmVEYXNoKSB7XHJcbiAgICAgICAgLy8gSUUgOSBhbmQgMTAgZG8gbm90IHN1cHBvcnQgbGluZSBkYXNoXHJcbiAgICAgICAgY3R4LnNldExpbmVEYXNoKHZhbHVlT3JEZWZhdWx0KGxlZ2VuZEl0ZW0ubGluZURhc2gsIGxpbmVEZWZhdWx0LmJvcmRlckRhc2gpKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKG9wdHMubGFiZWxzICYmIG9wdHMubGFiZWxzLnVzZVBvaW50U3R5bGUpIHtcclxuICAgICAgICAvLyBSZWNhbGN1bGF0ZSB4IGFuZCB5IGZvciBkcmF3UG9pbnQoKSBiZWNhdXNlIGl0cyBleHBlY3RpbmdcclxuICAgICAgICAvLyB4IGFuZCB5IHRvIGJlIGNlbnRlciBvZiBmaWd1cmUgKGluc3RlYWQgb2YgdG9wIGxlZnQpXHJcbiAgICAgICAgY29uc3QgcmFkaXVzID0gYm94V2lkdGggKiBNYXRoLlNRUlQyIC8gMjtcclxuICAgICAgICBjb25zdCBjZW50ZXJYID0geCArIGJveFdpZHRoIC8gMjtcclxuICAgICAgICBjb25zdCBjZW50ZXJZID0geSArIGZvbnRTaXplIC8gMjtcclxuXHJcbiAgICAgICAgLy8gRHJhdyBwb2ludFN0eWxlIGFzIGxlZ2VuZCBzeW1ib2xcclxuICAgICAgICBoZWxwZXJzLmNhbnZhcy5kcmF3UG9pbnQoY3R4LCBsZWdlbmRJdGVtLnBvaW50U3R5bGUsIHJhZGl1cywgY2VudGVyWCwgY2VudGVyWSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRHJhdyBib3ggYXMgbGVnZW5kIHN5bWJvbFxyXG4gICAgICAgIGlmIChsaW5lV2lkdGggIT09IDApIHtcclxuICAgICAgICAgIGN0eC5zdHJva2VSZWN0KHgsIHksIGJveFdpZHRoLCBmb250U2l6ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGN0eC5maWxsUmVjdCh4LCB5LCBib3hXaWR0aCwgZm9udFNpemUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjdHgucmVzdG9yZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBkcmF3U3RyaWtlVGhyb3VnaCA9ICh4LCB5LCB3KSA9PiB7XHJcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgY3R4LmxpbmVXaWR0aCA9IDI7XHJcbiAgICAgIGN0eC5tb3ZlVG8oeCwgeSk7XHJcbiAgICAgIGN0eC5saW5lVG8oeCArIHcsIHkpO1xyXG4gICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGRyYXdDcm9zc092ZXIgPSAoeCwgeSwgdywgaCkgPT4ge1xyXG4gICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgIGN0eC5saW5lV2lkdGggPSAyO1xyXG4gICAgICBjdHgubW92ZVRvKHgsIHkpO1xyXG4gICAgICBjdHgubGluZVRvKHggKyB3LCB5ICsgaCk7XHJcbiAgICAgIGN0eC5tb3ZlVG8oeCwgeSArIGgpO1xyXG4gICAgICBjdHgubGluZVRvKHggKyB3LCB5KTtcclxuICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBmaWxsVGV4dCA9ICh4LCB5LCBsZWdlbmRJdGVtLCB0ZXh0V2lkdGgpID0+IHtcclxuICAgICAgY29uc3QgaGFsZkZvbnRTaXplID0gZm9udFNpemUgLyAyO1xyXG4gICAgICBjb25zdCB4TGVmdCA9IGJveFdpZHRoICsgaGFsZkZvbnRTaXplICsgeDtcclxuICAgICAgY29uc3QgeU1pZGRsZSA9IHkgKyBoYWxmRm9udFNpemU7XHJcblxyXG4gICAgICBpZiAoaGVscGVycy5pc0FycmF5KGxlZ2VuZEl0ZW0udGV4dCkpIHtcclxuICAgICAgICBoZWxwZXJzLmVhY2gobGVnZW5kSXRlbS50ZXh0LCAodGV4dExpbmUsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBsaW5lT2Zmc2V0ID0gaW5kZXggKiBmb250U2l6ZTtcclxuICAgICAgICAgIGN0eC5maWxsVGV4dCh0ZXh0TGluZSwgeExlZnQsIHlNaWRkbGUgKyBsaW5lT2Zmc2V0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjdHguZmlsbFRleHQobGVnZW5kSXRlbS50ZXh0LCB4TGVmdCwgeU1pZGRsZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChsZWdlbmRJdGVtLmhpZGRlbikge1xyXG4gICAgICAgIGlmIChoZWxwZXJzLmlzQXJyYXkobGVnZW5kSXRlbS50ZXh0KSkge1xyXG4gICAgICAgICAgZHJhd0Nyb3NzT3Zlcih4TGVmdCwgeU1pZGRsZSwgdGV4dFdpZHRoLCAobGVnZW5kSXRlbS50ZXh0Lmxlbmd0aCAtIDEpICogKGZvbnRTaXplIC0gMSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBkcmF3U3RyaWtlVGhyb3VnaCh4TGVmdCwgeU1pZGRsZSwgdGV4dFdpZHRoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgYWxpZ25tZW50T2Zmc2V0ID0gKGRpbWVuc2lvbiwgYmxvY2tTaXplKSA9PiB7XHJcbiAgICAgIHN3aXRjaCAob3B0cy5hbGlnbikge1xyXG4gICAgICBjYXNlICdzdGFydCc6XHJcbiAgICAgICAgcmV0dXJuIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICBjYXNlICdlbmQnOlxyXG4gICAgICAgIHJldHVybiBkaW1lbnNpb24gLSBibG9ja1NpemU7XHJcbiAgICAgIGRlZmF1bHQ6IC8vIGNlbnRlclxyXG4gICAgICAgIHJldHVybiAoZGltZW5zaW9uIC0gYmxvY2tTaXplICsgbGFiZWxPcHRzLnBhZGRpbmcpIC8gMjtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBIb3Jpem9udGFsXHJcbiAgICBjb25zdCBpc0hvcml6b250YWwgPSBtZS5pc0hvcml6b250YWwoKTtcclxuICAgIGlmIChpc0hvcml6b250YWwpIHtcclxuICAgICAgY3Vyc29yID0ge1xyXG4gICAgICAgIHg6IG1lLmxlZnQgKyBhbGlnbm1lbnRPZmZzZXQobGVnZW5kV2lkdGgsIGxpbmVXaWR0aHNbMF0pLFxyXG4gICAgICAgIHk6IG1lLnRvcCArIGxhYmVsT3B0cy5wYWRkaW5nLFxyXG4gICAgICAgIGxpbmU6IDBcclxuICAgICAgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGN1cnNvciA9IHtcclxuICAgICAgICB4OiBtZS5sZWZ0ICsgbGFiZWxPcHRzLnBhZGRpbmcsXHJcbiAgICAgICAgeTogbWUudG9wICsgYWxpZ25tZW50T2Zmc2V0KGxlZ2VuZEhlaWdodCwgY29sdW1uSGVpZ2h0c1swXSksXHJcbiAgICAgICAgbGluZTogMFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGl0ZW1IZWlnaHQgPSBtYXhIZWlnaHQ7XHJcbiAgICBoZWxwZXJzLmVhY2gobWUubGVnZW5kSXRlbXMsIChsZWdlbmRJdGVtLCBpKSA9PiB7XHJcbiAgICAgIGxldCB0ZXh0V2lkdGg7XHJcbiAgICAgIGxldCBib3hUb3BPZmZzZXQ7XHJcblxyXG4gICAgICBpZiAoaGVscGVycy5pc0FycmF5KGxlZ2VuZEl0ZW0udGV4dCkpIHtcclxuICAgICAgICB0ZXh0V2lkdGggPSBsZWdlbmRJdGVtLnRleHQubWFwKHRleHRMaW5lID0+IHtcclxuICAgICAgICAgIHJldHVybiBjdHgubWVhc3VyZVRleHQodGV4dExpbmUpLndpZHRoO1xyXG4gICAgICAgIH0pLnJlZHVjZSgoYWNjLCB2KSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gdiA+IGFjYyA/IHYgOiBhY2M7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgYm94VG9wT2Zmc2V0ID0gZm9udFNpemUgLyAyICogKGxlZ2VuZEl0ZW0udGV4dC5sZW5ndGggLSAxKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0ZXh0V2lkdGggPSBjdHgubWVhc3VyZVRleHQobGVnZW5kSXRlbS50ZXh0KS53aWR0aDtcclxuICAgICAgICBib3hUb3BPZmZzZXQgPSAwO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB3aWR0aCA9IGJveFdpZHRoICsgKGZvbnRTaXplIC8gMikgKyB0ZXh0V2lkdGg7XHJcbiAgICAgIGxldCB4ID0gY3Vyc29yLng7XHJcbiAgICAgIGNvbnN0IHRvcE9mZnNldCA9IE1hdGgudHJ1bmMoKG1heEhlaWdodCAtIGhpdGJveGVzW2ldLmhlaWdodCkgLyAyKTtcclxuICAgICAgbGV0IHkgPSBjdXJzb3IueSArIHRvcE9mZnNldDtcclxuXHJcbiAgICAgIC8vIFVzZSAobWUubGVmdCArIG1lLm1pblNpemUud2lkdGgpIGFuZCAobWUudG9wICsgbWUubWluU2l6ZS5oZWlnaHQpXHJcbiAgICAgIC8vIGluc3RlYWQgb2YgbWUucmlnaHQgYW5kIG1lLmJvdHRvbSBiZWNhdXNlIG1lLndpZHRoIGFuZCBtZS5oZWlnaHRcclxuICAgICAgLy8gbWF5IGhhdmUgYmVlbiBjaGFuZ2VkIHNpbmNlIG1lLm1pblNpemUgd2FzIGNhbGN1bGF0ZWRcclxuICAgICAgaWYgKGlzSG9yaXpvbnRhbCkge1xyXG4gICAgICAgIGlmIChpID4gMCAmJiB4ICsgd2lkdGggKyBsYWJlbE9wdHMucGFkZGluZyA+IG1lLmxlZnQgKyBtZS5taW5TaXplLndpZHRoKSB7XHJcbiAgICAgICAgICB5ID0gY3Vyc29yLnkgKz0gaXRlbUhlaWdodDtcclxuICAgICAgICAgIGN1cnNvci5saW5lKys7XHJcbiAgICAgICAgICB4ID0gY3Vyc29yLnggPSBtZS5sZWZ0ICsgYWxpZ25tZW50T2Zmc2V0KGxlZ2VuZFdpZHRoLCBsaW5lV2lkdGhzW2N1cnNvci5saW5lXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKGkgPiAwICYmIHkgKyBpdGVtSGVpZ2h0ID4gbWUudG9wICsgbWUubWluU2l6ZS5oZWlnaHQpIHtcclxuICAgICAgICB4ID0gY3Vyc29yLnggPSB4ICsgbWUuY29sdW1uV2lkdGhzW2N1cnNvci5saW5lXSArIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICAgIGN1cnNvci5saW5lKys7XHJcbiAgICAgICAgeSA9IGN1cnNvci55ID0gbWUudG9wICsgYWxpZ25tZW50T2Zmc2V0KGxlZ2VuZEhlaWdodCwgY29sdW1uSGVpZ2h0c1tjdXJzb3IubGluZV0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBkcmF3TGVnZW5kQm94KHgsIHkgKyBib3hUb3BPZmZzZXQsIGxlZ2VuZEl0ZW0pO1xyXG5cclxuICAgICAgaGl0Ym94ZXNbaV0ubGVmdCA9IHg7XHJcbiAgICAgIGhpdGJveGVzW2ldLnRvcCA9IHk7XHJcblxyXG4gICAgICAvLyBGaWxsIHRoZSBhY3R1YWwgbGFiZWxcclxuICAgICAgZmlsbFRleHQoeCwgeSwgbGVnZW5kSXRlbSwgdGV4dFdpZHRoKTtcclxuXHJcbiAgICAgIGlmIChpc0hvcml6b250YWwpIHtcclxuICAgICAgICBjdXJzb3IueCArPSB3aWR0aCArIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGN1cnNvci55ICs9IGl0ZW1IZWlnaHQ7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1vbmtleVBhdGNoQ2hhcnRKc0xlZ2VuZCgpIHtcclxuICBjb25zdCBwbHVnaW5zID0gQ2hhcnQucGx1Z2lucy5nZXRBbGwoKTtcclxuICBjb25zdCBsZWdlbmQgPSBwbHVnaW5zLmZpbHRlcihwID0+IHAuaWQgPT09ICdsZWdlbmQnKVswXTtcclxuICBsZWdlbmQuX2VsZW1lbnQucHJvdG90eXBlLmZpdCA9IGZpdDtcclxuICBsZWdlbmQuX2VsZW1lbnQucHJvdG90eXBlLmRyYXcgPSBkcmF3O1xyXG59XHJcbiJdfQ==